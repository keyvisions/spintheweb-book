% Chapter 7: Webbase Layout Language (WBLL)

\chapter{Webbase Layout Language (WBLL)}
\label{chap:wbll}

\begin{quote}
\textit{"Simplicity is the ultimate sophistication."} \\
â€” Leonardo da Vinci
\end{quote}


The Webbase Layout Language (\textbf{WBLL}) defines how a content is presented. Where \wbdl{} describes \textit{what} exists (site, areas, pages, contents), WBLL describes \textit{how} it looks and behaves at render time.

\subsection{Data Context and Field Cursor}

It is the responsibility of the \wbdl{} content definition to query data. The result is an ordered recordset, where both the field names and their sequence are important for rendering.

The WBLL interpreter maintains a \textbf{field cursor} that tracks the current position within the recordset fields. Many tokens operate on the field at the current cursor position if no explicit field name is provided. After such a token is processed, the field cursor advances to the next field. If a token specifies a field name (e.g., \texttt{h('type;area')}), it uses the named field and does not move the cursor.

Some tokens may behave differently depending on the subtype of the content being rendered. This will be detailed for each token as needed.

A STWContent has a subtype, the subtype defines the content macroscopic appearance, e.g., a table, a calendar, WBLL digs deeper describing the content microscopically, i.e., how the queried data is rendered within the content. WBLL is a compact, token-based layout language interpreted by the Web Spinner. It compiles into an efficient render function that merges data (records, session values, placeholders) into HTML.



This chapter establishes the presentation layer contracts. In the next chapters we detail modular composition (\cref{chap:webbaselets}) and the runtime engine (\cref{chap:web-spinner}).

\subsection{Language Internals}

At its core, WBLL is a compact, token-based templating language. Unlike tag-based languages like HTML, WBLL uses a sequence of single-character mnemonics and special commands to define the structure and appearance of content. This design prioritizes conciseness and efficient processing.

The rendering process involves two main stages:

\begin{enumerate}
    \item \textbf{Lexing (Tokenization):} The WBLL source string is first parsed by a lexer, which uses a comprehensive regular expression to break the text into a series of tokens. Each token represents a specific layout element, such as a link (\texttt{a}), a button (\texttt{b}), a form input (\texttt{e}), or a simple text block (\texttt{t}). The lexer also captures arguments, attributes, and parameters associated with each token. Any unrecognized characters result in a syntax error.
    
    \item \textbf{Compilation and Rendering:} The resulting array of tokens is then compiled into a dynamic JavaScript render function. This function is specifically generated to produce HTML from the token sequence. When executed, it iterates through the tokens, merges data from records and session placeholders, and constructs the final HTML string. This just-in-time compilation allows for highly efficient rendering, as the logic is tailored precisely to the given layout.
\end{enumerate}


\subsection{Token Reference}

For the complete, uniform catalog of tokens (syntax, description, and examples), see Appendix \ref{app:wbll-tokens}.
