% Chapter 7: Webbase Layout Language (WBLL)

\chapter{Webbase Layout Language (WBLL)}
\label{chap:wbll}

\begin{quote}
\textit{"Simplicity is the ultimate sophistication."} \\
— Leonardo da Vinci
\end{quote}

% Macroscopic (WBDL) vs microscopic (WBLL)
In \wbdl{}, the portal is specified \textit{macroscopically}: from \emph{Site} to \emph{Area} to \emph{Page}, and for each Page the set of \emph{Contents}. For every Content, \wbdl{} declares its \emph{subtype} (for example: table, calendar, tree, menu, form), the \emph{datasource}, and the \emph{query} to run. WBLL operates \textit{microscopically}, describing how the queried data should be rendered within that Content’s shape.

\subsection{Data Context and Field Cursor}

It is the responsibility of the \wbdl{} content definition to query data. The result is an ordered recordset, where both the field names and their sequence are important for rendering.

The WBLL interpreter maintains a \textbf{field cursor} that tracks the current position within the recordset fields. Many tokens operate on the field at the current cursor position if no explicit field name is provided; tokens that specify a field name use that field without moving the cursor. Some tokens may also vary their behavior based on the content subtype; this is documented with each token where relevant.

\paragraph{Cursor movement rule}
By convention, the field cursor advances if and only if a token implicitly consumes the active field (i.e., it reads a field value without naming a field explicitly). Tokens that only render constants, or that reference a field by name, do not move the cursor.

\begin{itemize}
  \item Cursor-advancing (implicit field): a token used without a field name consumes the active field and advances the cursor.\\
  Example: \texttt{h} renders \texttt{<input type="hidden" name="<active>" value="<value>">} and advances.
  \item Non-advancing (explicit field): a token that names a field uses that field but leaves the cursor unchanged.\\
  Example: \texttt{h('type;area')} renders \texttt{<input type="hidden" name="type" value="area">} and does not advance.
  \item Non-consuming: tokens that render only literals or structural markup do not touch the cursor.\\
  Example: \texttt{t('Hello World!')} does not advance.
\end{itemize}

Implementations typically mark a token as having consumed the active field only if it bound to it implicitly; explicit bindings and literal-only tokens leave the cursor position intact.

This chapter establishes the presentation-layer contracts. In the next chapters we detail modular composition (\cref{chap:webbaselets}) and the runtime engine (\cref{chap:web-spinner}).

\subsection{Language Internals}

At its core, WBLL is a compact, token-based templating language. Unlike tag-based languages like HTML, WBLL uses a sequence of single-character mnemonics and special commands to define the structure and appearance of content. This design prioritizes conciseness and efficient processing.

The rendering process involves two main stages:

\begin{enumerate}
    \item \textbf{Lexing (Tokenization):} The WBLL source string is first parsed by a lexer, which uses a comprehensive regular expression to break the text into a series of tokens. Each token represents a specific layout element, such as a link (\texttt{a}), a button (\texttt{b}), a form input (\texttt{e}), or a simple text block (\texttt{t}). The lexer also captures arguments, attributes, and parameters associated with each token. Any unrecognized characters result in a syntax error.
    
    \item \textbf{Compilation and Rendering:} The resulting array of tokens is then compiled into a dynamic JavaScript render function. This function is specifically generated to produce HTML from the token sequence. When executed, it iterates through the tokens, merges data from records and session placeholders, and constructs the final HTML string. This just-in-time compilation allows for highly efficient rendering, as the logic is tailored precisely to the given layout.
\end{enumerate}


\subsection{Token Reference}

For the complete, uniform catalog of tokens (syntax, description, and examples), see Appendix \ref{app:wbll-tokens}.
