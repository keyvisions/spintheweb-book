% Chapter 4: The STWElement Base
\chapter{The STWElement Base}
\label{chap:stwlement}

\begin{quote}
\textit{"In programming, the hard part isn't solving problems, but deciding what problems to solve."} \\
â€” Paul Graham
\end{quote}

\section{Introduction}

WBDL defines a base element, \texttt{STWElement}, from which all other elements inherit. This foundational type establishes the common properties and behaviors shared by all elements in the webbase hierarchy.

\section{XSD Definition}

Below is the XML Schema Definition for the fundamental \texttt{STWElement} type:

\begin{lstlisting}[language=XML,caption={STWElement XSD Definition}]
<xs:complexType name="STWElement">
    <xs:sequence>
        <xs:element name="name" type="STWLocalized" minOccurs="1" />
        <xs:element name="slug" type="STWLocalized" minOccurs="1" />
        <xs:element name="keywords" type="STWLocalized" minOccurs="0" />
        <xs:element name="description" type="STWLocalized" minOccurs="0" />
        <xs:element name="visibility" type="STWVisibility" minOccurs="0" />
        <xs:element name="children" minOccurs="0">
            <xs:complexType>
                <xs:choice minOccurs="1" maxOccurs="unbounded">
                    <xs:element name="area" type="STWArea" />
                    <xs:element name="page" type="STWPage" />
                    <xs:element name="content" type="STWContent" />
                </xs:choice>
            </xs:complexType>
        </xs:element>
    </xs:sequence>
    <xs:attribute name="_id" type="GUID" use="required" />
    <xs:attribute name="type" type="STWElementType" use="required" />
</xs:complexType>
\end{lstlisting}

\section{Supporting Type Definitions}

\subsection{GUID Type}

The GUID type ensures unique identification across all elements:

\begin{lstlisting}[language=XML,caption={GUID Type Definition}]
<xs:simpleType name="GUID">
    <xs:restriction base="xs:string">
        <xs:pattern value="[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}" />
    </xs:restriction>
</xs:simpleType>
\end{lstlisting}

\subsection{Element Type Enumeration}

The \texttt{STWElementType} defines the four core element types:

\begin{lstlisting}[language=XML,caption={STWElementType Definition}]
<xs:simpleType name="STWElementType">
    <xs:restriction base="xs:string">
        <xs:enumeration value="Site"/>
        <xs:enumeration value="Area"/>
        <xs:enumeration value="Page"/>
        <xs:enumeration value="Content"/>
    </xs:restriction>
</xs:simpleType>
\end{lstlisting}

\subsection{Localized Content}

The \texttt{STWLocalized} type enables multi-language support:

\begin{lstlisting}[language=XML,caption={STWLocalized Type Definition}]
<xs:complexType name="STWLocalized">
    <xs:sequence>
        <xs:element name="text" minOccurs="1" maxOccurs="unbounded">
            <xs:complexType>
                <xs:simpleContent>
                    <xs:extension base="xs:string">
                        <xs:attribute name="lang" type="xs:language" use="required"/>
                    </xs:extension>
                </xs:simpleContent>
            </xs:complexType>
        </xs:element>
    </xs:sequence>
</xs:complexType>
\end{lstlisting}

\subsection{Visibility Rules}

The \texttt{STWVisibility} type implements role-based access control:

\begin{lstlisting}[language=XML,caption={STWVisibility Type Definition}]
<xs:complexType name="STWVisibility">
    <xs:sequence>
        <xs:element name="rule" minOccurs="0" maxOccurs="unbounded">
            <xs:complexType>
                <xs:attribute name="role" type="xs:string" use="required"/>
                <xs:attribute name="visible" type="xs:boolean" use="required"/>
            </xs:complexType>
        </xs:element>
    </xs:sequence>
</xs:complexType>
\end{lstlisting}

\section{Property Descriptions}

\subsection{Core Attributes}

\begin{description}
\item[\texttt{\_id}] A unique identifier for the element (GUID). This ensures global uniqueness across the entire webbase.

\item[\texttt{type}] The specific type of the element. Can be one of 'Site', 'Area', 'Page', or 'Content'.
\end{description}

\subsection{Localized Properties}

\begin{description}
\item[\texttt{name}] A localizable name for the element. Composed of one or more \texttt{text} elements, each with a \texttt{lang} attribute specifying the language (e.g., "en", "it-IT"). 

Example:
\begin{lstlisting}[language=XML]
<name>
    <text lang="en"><![CDATA[R&D]]></text>
    <text lang="it"><![CDATA[R&S]]></text>
</name>
\end{lstlisting}

\item[\texttt{slug}] A localizable, URL-friendly version of the name. Initially derived from the \texttt{name} by converting to lowercase and removing all characters except letters (a-z, A-Z), numbers (0-9), and underscores (\_), but can be manually overridden.

\item[\texttt{keywords}] Localizable keywords for SEO purposes. Follows the same structure as \texttt{name}.

\item[\texttt{description}] A localizable description of the element. Follows the same structure as \texttt{name}.
\end{description}

\subsection{Visibility and Structure}

\begin{description}
\item[\texttt{visibility}] Defines visibility rules based on user roles. Contains rules assigning \texttt{true} (visible) or \texttt{false} (not visible) to specific roles. If no rule is defined for a role, visibility is determined by checking parent element rules hierarchically. Elements are not visible by default if no rules match.

\item[\texttt{children}] A list of child \texttt{STWElement} objects, enabling the hierarchical structure of the webbase.
\end{description}

\section{Chapter Summary}

The \texttt{STWElement} base type establishes the foundation for all WBDL elements, providing essential properties for identification, localization, hierarchical organization, and access control.

\textbf{Next}: In \chapref{chap:05}, we will explore the specialized element types that extend \texttt{STWElement}.
